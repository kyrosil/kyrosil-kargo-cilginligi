<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trendyol Kargo Kapmaca</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.4/p5.min.js"></script>
  <style>
    body { margin: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background-color: #f0f0f0; }
    canvas { border: 2px solid #000; display: none; }
    #startScreen { text-align: center; }
    #startScreen img { margin: 10px; width: 100px; }
    #startButton, #restartButton, #message { margin-top: 10px; padding: 10px 20px; font-size: 16px; }
    #startButton, #restartButton { cursor: pointer; background-color: #ff6200; color: white; border: none; border-radius: 5px; }
    #message { color: red; display: none; }
  </style>
</head>
<body>
  <div id="gameCanvas"></div>
  <div id="startScreen">
    <img src="images.jpg" alt="Trendyol Logo" width="100">
    <img src="cropped-adsiz_tasarim-removebg-preview-1.png" alt="Kyrosil Logo" width="100">
    <h2>Trendyol Kargo Kapmaca</h2>
    <p>50 puana ulaş, <strong>50 TL Trendyol Hediye Çeki</strong> kazan!</p>
    <p>Günde 3 hakla oyna, 3 kargo kaçırırsan oyun biter!</p>
    <button id="startButton" onclick="startGame()">Başla</button>
  </div>
  <div id="message"></div>
  <button id="restartButton" onclick="restartGame()">Yeniden Başlat</button>
<script>
let gleen;
let kargolar = [];
let score = 0;
let misses = 0;
let giftMessage = '';
let gameOver = false;
let lives = 3;
let trendyolLogo, kyrosilLogo;
let gameState = 'startScreen';

function checkLives() {
  const today = new Date().toDateString();
  const storedDate = localStorage.getItem('gameDate');
  const storedLives = parseInt(localStorage.getItem('lives')) || 3;

  if (storedDate !== today) {
    localStorage.setItem('gameDate', today);
    localStorage.setItem('lives', 3);
    return 3;
  }
  console.log('Stored lives:', storedLives);
  return storedLives;
}

function updateLives() {
  lives = checkLives();
  console.log('Current lives:', lives);
  if (lives <= 0) {
    gameOver = true;
    document.getElementById('message').style.display = 'block';
    document.getElementById('message').innerText = 'Günlük 3 hakkın bitti! Yarın tekrar dene.';
    document.getElementById('restartButton').style.display = 'none';
    noLoop();
  }
}

function preload() {
  try {
    trendyolLogo = loadImage('images.jpg');
    kyrosilLogo = loadImage('cropped-adsiz_tasarim-removebg-preview-1.png');
    console.log('Logolar yüklendi');
  } catch (e) {
    console.error('Logo yükleme hatası:', e);
    trendyolLogo = null;
    kyrosilLogo = null;
  }
}

function setup() {
  let canvas = createCanvas(800, 600);
  canvas.parent('gameCanvas');
  gleen = { x: width / 2, y: height - 50, w: 50, h: 50 };
  kargolar = [];
  score = 0;
  misses = 0;
  giftMessage = '';
  gameOver = false;
  gameState = 'playing';
  document.getElementById('restartButton').style.display = 'none';
  document.getElementById('message').style.display = 'none';
  document.getElementById('gameCanvas').style.display = 'block';
  document.getElementById('startScreen').style.display = 'none';
  updateLives();
  console.log('Setup tamamlandı, oyun başlıyor');
}

function draw() {
  background(220);

  if (gameState === 'startScreen') {
    document.getElementById('startScreen').style.display = 'block';
    document.getElementById('gameCanvas').style.display = 'none';
    noLoop();
    console.log('Başlama ekranı gösteriliyor');
    return;
  }

  if (gameOver) {
    fill(255, 0, 0);
    textSize(40);
    textAlign(CENTER);
    text('Game Over! Puan: ' + score, width / 2, height / 2);
    if (lives > 0) {
      document.getElementById('restartButton').style.display = 'block';
    } else {
      document.getElementById('message').style.display = 'block';
      document.getElementById('message').innerText = 'Günlük 3 hakkın bitti! Yarın tekrar dene.';
      document.getElementById('restartButton').style.display = 'none';
    }
    noLoop();
    console.log('Oyun bitti, puan:', score, 'Haklar:', lives);
    return;
  }

  fill(0, 0, 255);
  rect(gleen.x, gleen.y, gleen.w, gleen.h);

  gleen.x = mouseX - gleen.w / 2;
  if (gleen.x < 0) gleen.x = 0;
  if (gleen.x > width - gleen.w) gleen.x = width - gleen.w;

  if (frameCount % 60 === 0 && lives > 0) {
    let isBonus = random(1) < 0.15;
    kargolar.push({
      x: random(width - 30),
      y: 0,
      w: 30,
      h: 30,
      speed: random(4, 8),
      isBonus: isBonus
    });
    console.log('Yeni kargo eklendi, bonus:', isBonus);
  }

  for (let i = kargolar.length - 1; i >= 0; i--) {
    let kargo = kargolar[i];
    kargo.y += kargo.speed;

    if (kargo.isBonus && kyrosilLogo) {
      image(kyrosilLogo, kargo.x, kargo.y, kargo.w, kargo.h);
    } else if (!kargo.isBonus && trendyolLogo) {
      image(trendyolLogo, kargo.x, kargo.y, kargo.w, kargo.h);
    } else {
      fill(kargo.isBonus ? 'yellow' : 'brown');
      rect(kargo.x, kargo.y, kargo.w, kargo.h);
    }

    if (
      gleen.x < kargo.x + kargo.w &&
      gleen.x + gleen.w > kargo.x &&
      gleen.y < kargo.y + kargo.h &&
      gleen.y + gleen.h > kargo.y
    ) {
      score += kargo.isBonus ? 5 : 1;
      kargolar.splice(i, 1);
      console.log('Kargo yakalandı, puan:', score);
      if (score >= 50) {
        giftMessage = 'Tebrikler! 50 TL Trendyol Hediye Çeki Kazandın!';
      }
    }

    if (kargo.y > height) {
      kargolar.splice(i, 1);
      misses += 1;
      console.log('Kargo kaçırıldı, kaçırılan:', misses);
      if (misses >= 3) {
        gameOver = true;
        lives -= 1;
        localStorage.setItem('lives', lives);
        updateLives();
      }
    }
  }

  fill(0);
  textSize(20);
  textAlign(LEFT);
  text('Puan: ' + score, 10, 30);
  text('Kaçırılan: ' + misses + '/3', 10, 60);
  text('Hak: ' + lives + '/3', 10, 90);
  if (giftMessage) {
    textAlign(CENTER);
    textSize(24);
    fill(255, 0, 0);
    text(giftMessage, width / 2, height / 2);
  }
}

function startGame() {
  if (lives > 0) {
    gameState = 'playing';
    setup();
    loop();
    console.log('Oyun başlatıldı, haklar:', lives);
  } else {
    document.getElementById('message').style.display = 'block';
    document.getElementById('message').innerText = 'Günlük 3 hakkın bitti! Yarın tekrar dene.';
    console.log('Haklar bitti, oyun başlatılamadı');
  }
}

function restartGame() {
  if (lives > 0) {
    lives -= 1;
    localStorage.setItem('lives', lives);
    setup();
    loop();
    console.log('Oyun yeniden başlatıldı, kalan haklar:', lives);
  } else {
    console.log('Yeniden başlatılamadı, haklar bitti');
  }
}
</script>
</body>
</html>
